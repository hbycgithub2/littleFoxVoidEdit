<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V3.0é«˜çº§ç‰¹æ€§æµ‹è¯• - æ—¶é—´è½´ç¼©ç•¥å›¾</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #4CAF50;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        #videoContainer {
            margin: 20px 0;
        }
        video {
            width: 100%;
            max-width: 640px;
            border-radius: 8px;
        }
        #phaserContainer {
            margin: 20px 0;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            overflow: hidden;
        }
        #console {
            background: #000;
            color: #0f0;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 300px;
            overflow-y: auto;
            border-radius: 4px;
        }
        .info {
            background: #1e3a5f;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #2196F3;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .feature-item {
            background: #333;
            padding: 15px;
            border-radius: 4px;
            border-left: 3px solid #4CAF50;
        }
        .feature-title {
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
        }
        .feature-desc {
            font-size: 14px;
            color: #aaa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŸ æ—¶é—´è½´ç¼©ç•¥å›¾ - V3.0é«˜çº§ç‰¹æ€§æµ‹è¯•</h1>
        
        <div class="info">
            <strong>V3.0æ–°ç‰¹æ€§ï¼š</strong>
            <div class="feature-grid">
                <div class="feature-item">
                    <div class="feature-title">âš¡ Web Worker</div>
                    <div class="feature-desc">åå°å¼‚æ­¥å¤„ç†ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹</div>
                </div>
                <div class="feature-item">
                    <div class="feature-title">ğŸ¯ æ™ºèƒ½é‡‡æ ·</div>
                    <div class="feature-desc">æ£€æµ‹å…³é”®å¸§ï¼Œä¼˜åŒ–é‡‡æ ·ç‚¹</div>
                </div>
                <div class="feature-item">
                    <div class="feature-title">ğŸ“ˆ æ¸è¿›å¼åŠ è½½</div>
                    <div class="feature-desc">å…ˆä½åˆ†è¾¨ç‡ï¼Œåé«˜æ¸…</div>
                </div>
                <div class="feature-item">
                    <div class="feature-title">ğŸ® é«˜çº§äº¤äº’</div>
                    <div class="feature-desc">ç¼©æ”¾ã€æƒ¯æ€§æ»šåŠ¨ã€ç‚¹å‡»å®šä½</div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>æ­¥éª¤1ï¼šåŠ è½½è§†é¢‘</h3>
            <div id="videoContainer">
                <video id="video" controls preload="metadata" crossorigin="anonymous">
                    <source src="assets/videos/001_I_Can_Hop.mp4" type="video/mp4">
                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
                </video>
            </div>
        </div>
        
        <div class="test-section">
            <h3>æ­¥éª¤2ï¼šé€‰æ‹©ç‰ˆæœ¬</h3>
            <button onclick="enableVersion('v1.0')">V1.0 MVP</button>
            <button onclick="enableVersion('v2.0')">V2.0 æ€§èƒ½ä¼˜åŒ–</button>
            <button onclick="enableVersion('v3.0')">V3.0 é«˜çº§ç‰¹æ€§ï¼ˆæ¨èï¼‰</button>
            <button id="generateBtn" onclick="generateThumbnails()" disabled>ç”Ÿæˆç¼©ç•¥å›¾</button>
            <button onclick="runDiagnostics()" style="background:#FF9800;">ğŸ” è¿è¡Œè¯Šæ–­</button>
        </div>
        
        <div class="test-section">
            <h3>æ­¥éª¤3ï¼šæŸ¥çœ‹ç¼©ç•¥å›¾</h3>
            <div id="phaserContainer"></div>
            <p style="color: #888;">
                ğŸ’¡ äº¤äº’æç¤ºï¼š<br>
                - æ‹–æ‹½æ»šåŠ¨ï¼ˆæ”¯æŒæƒ¯æ€§ï¼‰<br>
                - æ»šè½®ç¼©æ”¾<br>
                - åŒå‡»ç¼©æ”¾<br>
                - å•å‡»å®šä½æ—¶é—´
            </p>
        </div>
        
        <div class="test-section">
            <h3>ç‰ˆæœ¬å¯¹æ¯”</h3>
            <table style="width:100%; border-collapse: collapse;">
                <tr style="background:#333;">
                    <th style="padding:10px; border:1px solid #555;">ç‰¹æ€§</th>
                    <th style="padding:10px; border:1px solid #555;">V1.0</th>
                    <th style="padding:10px; border:1px solid #555;">V2.0</th>
                    <th style="padding:10px; border:1px solid #555;">V3.0</th>
                </tr>
                <tr>
                    <td style="padding:10px; border:1px solid #555;">åŸºç¡€åŠŸèƒ½</td>
                    <td style="padding:10px; border:1px solid #555;">âœ…</td>
                    <td style="padding:10px; border:1px solid #555;">âœ…</td>
                    <td style="padding:10px; border:1px solid #555;">âœ…</td>
                </tr>
                <tr>
                    <td style="padding:10px; border:1px solid #555;">æ€§èƒ½ä¼˜åŒ–</td>
                    <td style="padding:10px; border:1px solid #555;">âŒ</td>
                    <td style="padding:10px; border:1px solid #555;">âœ…</td>
                    <td style="padding:10px; border:1px solid #555;">âœ…</td>
                </tr>
                <tr>
                    <td style="padding:10px; border:1px solid #555;">é«˜çº§ç‰¹æ€§</td>
                    <td style="padding:10px; border:1px solid #555;">âŒ</td>
                    <td style="padding:10px; border:1px solid #555;">âŒ</td>
                    <td style="padding:10px; border:1px solid #555;">âœ…</td>
                </tr>
            </table>
        </div>
        
        <div class="test-section">
            <h3>æ§åˆ¶å°è¾“å‡º</h3>
            <button onclick="clearConsole()">æ¸…ç©º</button>
            <div id="console"></div>
        </div>
    </div>
    
    <script>
        // æ‹¦æˆªconsole.log
        const consoleDiv = document.getElementById('console');
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleDiv.innerHTML += '<span style="color: #0f0;">' + message + '</span><br>';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleDiv.innerHTML += '<span style="color: #f44;">' + message + '</span><br>';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        function clearConsole() {
            consoleDiv.innerHTML = '';
        }
        
        function runDiagnostics() {
            console.log('\n========== è¿è¡Œæ·±åº¦10å±‚è¯Šæ–­ ==========\n');
            
            // å±‚1-10æ£€æŸ¥
            console.log('ğŸ“¦ å±‚1: å…¨å±€å¯¹è±¡');
            console.log('  game:', !!window.game);
            console.log('  thumbnailInitializer:', !!window.thumbnailInitializer);
            
            if (window.game) {
                console.log('\nğŸ® å±‚2: Phaser Game');
                console.log('  scene:', !!window.game.scene);
                
                const scene = window.game.scene.getScene('TimelineThumbnailScene');
                console.log('\nğŸ¬ å±‚3: Scene');
                console.log('  TimelineThumbnailScene:', !!scene);
                if (scene) {
                    console.log('  thumbnailLayer:', !!scene.thumbnailLayer);
                    console.log('  thumbnailLayer.list.length:', scene.thumbnailLayer.list.length);
                }
            }
            
            if (window.thumbnailInitializer) {
                console.log('\nğŸ”§ å±‚4: Initializer');
                console.log('  initialized:', window.thumbnailInitializer.initialized);
                console.log('  enabled:', window.thumbnailInitializer.config.enabled);
                console.log('  renderer:', !!window.thumbnailInitializer.renderer);
                
                if (window.thumbnailInitializer.renderer) {
                    console.log('\nğŸ¨ å±‚5: Renderer');
                    const stats = window.thumbnailInitializer.renderer.getStats();
                    console.log('  stats:', stats);
                }
            }
            
            const video = document.getElementById('video');
            console.log('\nğŸ“¹ å±‚6: Video');
            console.log('  video:', !!video);
            if (video) {
                console.log('  duration:', video.duration);
                console.log('  readyState:', video.readyState);
            }
            
            console.log('\n========== è¯Šæ–­å®Œæˆ ==========\n');
        }
        
        let selectedVersion = 'v3.0';
        
        function enableVersion(version) {
            console.log(`=== é€‰æ‹©ç‰ˆæœ¬: ${version} ===`);
            selectedVersion = version;
            
            if (window.thumbnailInitializer) {
                console.log('âœ… å¼€å§‹å¯ç”¨...');
                window.thumbnailInitializer.enable(version);
                
                // ç­‰å¾…å¯åŠ¨å®Œæˆ
                setTimeout(() => {
                    console.log('\n=== å¯åŠ¨åæ£€æŸ¥ ===');
                    const scene = window.game.scene.getScene('TimelineThumbnailScene');
                    console.log('  Scene:', !!scene);
                    console.log('  Renderer:', !!window.thumbnailInitializer.renderer);
                    console.log('  Scroller:', !!window.thumbnailInitializer.scroller);
                    
                    if (scene) {
                        console.log('  thumbnailLayer:', !!scene.thumbnailLayer);
                        console.log('  cameras.main:', !!scene.cameras.main);
                    }
                    
                    document.getElementById('generateBtn').disabled = false;
                    
                    // ç¦ç”¨ç‰ˆæœ¬æŒ‰é’®
                    const buttons = document.querySelectorAll('button');
                    buttons.forEach(btn => {
                        if (btn.textContent.includes('V1.0') || 
                            btn.textContent.includes('V2.0') || 
                            btn.textContent.includes('V3.0')) {
                            btn.disabled = true;
                        }
                    });
                }, 500);
            } else {
                console.error('âŒ ThumbnailInitializeræœªåŠ è½½');
                alert('ThumbnailInitializeræœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢');
            }
        }
        
        function generateThumbnails() {
            console.log('=== æ‰‹åŠ¨ç”Ÿæˆç¼©ç•¥å›¾ ===');
            const video = document.getElementById('video');
            
            if (!video || !video.duration) {
                console.error('âŒ è§†é¢‘æœªåŠ è½½æˆ–æ—¶é•¿ä¸º0');
                alert('è¯·å…ˆç­‰å¾…è§†é¢‘åŠ è½½å®Œæˆ');
                return;
            }
            
            console.log('âœ… è§†é¢‘å·²åŠ è½½:', {
                duration: video.duration,
                width: video.videoWidth,
                height: video.videoHeight
            });
            
            if (window.thumbnailInitializer) {
                console.log('âœ… ThumbnailInitializerå­˜åœ¨');
                console.log('  initialized:', window.thumbnailInitializer.initialized);
                console.log('  renderer:', !!window.thumbnailInitializer.renderer);
                
                window.thumbnailInitializer.loadVideo(video);
                document.getElementById('generateBtn').disabled = true;
                
                // 5ç§’åè¿è¡Œè¯Šæ–­
                setTimeout(() => {
                    console.log('\n=== 5ç§’åè¯Šæ–­ ===');
                    if (window.thumbnailInitializer.renderer) {
                        const stats = window.thumbnailInitializer.renderer.getStats();
                        console.log('Rendererç»Ÿè®¡:', stats);
                    }
                }, 5000);
            } else {
                console.error('âŒ ThumbnailInitializeræœªåŠ è½½');
                alert('ThumbnailInitializeræœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('ğŸš€ V3.0é«˜çº§ç‰¹æ€§æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ\n');
                console.log('ğŸ’¡ æ“ä½œæ­¥éª¤:');
                console.log('  1. ç­‰å¾…è§†é¢‘åŠ è½½å®Œæˆ');
                console.log('  2. é€‰æ‹©ç‰ˆæœ¬ï¼ˆæ¨èV3.0ï¼‰');
                console.log('  3. ç‚¹å‡»"ç”Ÿæˆç¼©ç•¥å›¾"æŒ‰é’®');
                console.log('  4. ä½“éªŒé«˜çº§äº¤äº’åŠŸèƒ½\n');
                console.log('ğŸ® äº¤äº’è¯´æ˜:');
                console.log('  - æ‹–æ‹½æ»šåŠ¨ï¼ˆæ¾å¼€åæœ‰æƒ¯æ€§æ•ˆæœï¼‰');
                console.log('  - æ»šè½®ç¼©æ”¾');
                console.log('  - åŒå‡»ç¼©æ”¾');
                console.log('  - å•å‡»å®šä½åˆ°å¯¹åº”æ—¶é—´\n');
            }, 1000);
        });
    </script>
    
    <!-- Phaser 3 åº“ -->
    <script src="lib/phaser.min.js"></script>
    
    <!-- åº”ç”¨å…¥å£ -->
    <script type="module" src="src/main.js"></script>
</body>
</html>
