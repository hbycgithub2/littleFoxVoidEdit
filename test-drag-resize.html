<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹–æ‹½å’Œç¼©æ”¾åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #4CAF50;
            margin-bottom: 10px;
        }
        
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border: 2px solid #4CAF50;
        }
        
        .test-item {
            margin: 10px 0;
            padding: 10px;
            background: #333;
            border-radius: 4px;
        }
        
        .test-item.pass {
            border-left: 4px solid #4CAF50;
        }
        
        .test-item.fail {
            border-left: 4px solid #f44336;
        }
        
        .test-item.pending {
            border-left: 4px solid #ff9800;
        }
        
        .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .status.pass {
            background: #4CAF50;
        }
        
        .status.fail {
            background: #f44336;
        }
        
        .status.pending {
            background: #ff9800;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .instructions {
            background: #1e3a5f;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #64B5F6;
        }
        
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin: 5px 0;
        }
        
        #gameCanvas {
            border: 2px solid #4CAF50;
            margin-top: 20px;
        }
        
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #1a1a1a;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® æ‹–æ‹½å’Œç¼©æ”¾åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="instructions">
            <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
            <ol>
                <li>ç‚¹å‡»"å¼€å§‹æµ‹è¯•"æŒ‰é’®åˆå§‹åŒ–åœºæ™¯</li>
                <li>åœºæ™¯ä¼šè‡ªåŠ¨åˆ›å»º 3 ä¸ªæµ‹è¯•çƒ­åŒºï¼ˆçŸ©å½¢ã€åœ†å½¢ã€æ¤­åœ†ï¼‰</li>
                <li>æŒ‰ç…§ä¸‹æ–¹æµ‹è¯•é¡¹é€ä¸€æµ‹è¯•åŠŸèƒ½</li>
                <li>æ¯ä¸ªæµ‹è¯•é¡¹ä¼šè‡ªåŠ¨éªŒè¯å¹¶æ˜¾ç¤ºç»“æœ</li>
            </ol>
        </div>
        
        <button id="startTest" onclick="startTest()">å¼€å§‹æµ‹è¯•</button>
        <button id="resetTest" onclick="resetTest()" disabled>é‡ç½®æµ‹è¯•</button>
        
        <div class="test-section">
            <h2>âœ… æµ‹è¯•é¡¹ç›®</h2>
            
            <div class="test-item pending" id="test1">
                <span class="status pending">å¾…æµ‹è¯•</span>
                <strong>æµ‹è¯• 1: æ‹–æ‹½ç§»åŠ¨å•ä¸ªçƒ­åŒº</strong>
                <p>æ“ä½œï¼šç‚¹å‡»å¹¶æ‹–æ‹½ä»»æ„ä¸€ä¸ªçƒ­åŒº</p>
                <div class="result" id="result1"></div>
            </div>
            
            <div class="test-item pending" id="test2">
                <span class="status pending">å¾…æµ‹è¯•</span>
                <strong>æµ‹è¯• 2: æ‹–æ‹½ç§»åŠ¨å¤šä¸ªçƒ­åŒº</strong>
                <p>æ“ä½œï¼šæŒ‰ä½ Ctrl ç‚¹å‡»å¤šä¸ªçƒ­åŒºé€‰ä¸­ï¼Œç„¶åæ‹–æ‹½å…¶ä¸­ä¸€ä¸ª</p>
                <div class="result" id="result2"></div>
            </div>
            
            <div class="test-item pending" id="test3">
                <span class="status pending">å¾…æµ‹è¯•</span>
                <strong>æµ‹è¯• 3: ç¼©æ”¾æ‰‹æŸ„æ˜¾ç¤º</strong>
                <p>æ“ä½œï¼šç‚¹å‡»é€‰ä¸­ä¸€ä¸ªçƒ­åŒºï¼Œè§‚å¯Ÿæ˜¯å¦æ˜¾ç¤ºç¼©æ”¾æ‰‹æŸ„</p>
                <div class="result" id="result3"></div>
            </div>
            
            <div class="test-item pending" id="test4">
                <span class="status pending">å¾…æµ‹è¯•</span>
                <strong>æµ‹è¯• 4: 8 ä¸ªæ–¹å‘ç¼©æ”¾ï¼ˆçŸ©å½¢ï¼‰</strong>
                <p>æ“ä½œï¼šé€‰ä¸­çŸ©å½¢çƒ­åŒºï¼Œæ‹–æ‹½ 8 ä¸ªæ–¹å‘çš„æ‰‹æŸ„è¿›è¡Œç¼©æ”¾</p>
                <div class="result" id="result4"></div>
            </div>
            
            <div class="test-item pending" id="test5">
                <span class="status pending">å¾…æµ‹è¯•</span>
                <strong>æµ‹è¯• 5: ç¼©æ”¾æ—¶ä¿æŒæ¯”ä¾‹ï¼ˆShiftï¼‰</strong>
                <p>æ“ä½œï¼šé€‰ä¸­çŸ©å½¢çƒ­åŒºï¼ŒæŒ‰ä½ Shift æ‹–æ‹½è§’æ‰‹æŸ„</p>
                <div class="result" id="result5"></div>
            </div>
            
            <div class="test-item pending" id="test6">
                <span class="status pending">å¾…æµ‹è¯•</span>
                <strong>æµ‹è¯• 6: ç¼©æ”¾æœ€å°å°ºå¯¸é™åˆ¶</strong>
                <p>æ“ä½œï¼šå°è¯•å°†çƒ­åŒºç¼©æ”¾åˆ°éå¸¸å°ï¼ŒéªŒè¯æ˜¯å¦æœ‰æœ€å°å°ºå¯¸é™åˆ¶</p>
                <div class="result" id="result6"></div>
            </div>
            
            <div class="test-item pending" id="test7">
                <span class="status pending">å¾…æµ‹è¯•</span>
                <strong>æµ‹è¯• 7: æ‹–æ‹½å¸é™„å¯¹é½</strong>
                <p>æ“ä½œï¼šæ‹–æ‹½çƒ­åŒºé è¿‘å…¶ä»–çƒ­åŒºï¼Œè§‚å¯Ÿæ˜¯å¦è‡ªåŠ¨å¯¹é½å¹¶æ˜¾ç¤ºå¯¹é½çº¿</p>
                <div class="result" id="result7"></div>
            </div>
            
            <div class="test-item pending" id="test8">
                <span class="status pending">å¾…æµ‹è¯•</span>
                <strong>æµ‹è¯• 8: Ctrl æ‹–æ‹½å¤åˆ¶</strong>
                <p>æ“ä½œï¼šæŒ‰ä½ Ctrl æ‹–æ‹½çƒ­åŒºï¼ŒéªŒè¯æ˜¯å¦åˆ›å»ºå‰¯æœ¬</p>
                <div class="result" id="result8"></div>
            </div>
            
            <div class="test-item pending" id="test9">
                <span class="status pending">å¾…æµ‹è¯•</span>
                <strong>æµ‹è¯• 9: Alt ä»ä¸­å¿ƒç¼©æ”¾</strong>
                <p>æ“ä½œï¼šæŒ‰ä½ Alt æ‹–æ‹½ç¼©æ”¾æ‰‹æŸ„ï¼ŒéªŒè¯æ˜¯å¦ä»ä¸­å¿ƒç¼©æ”¾</p>
                <div class="result" id="result9"></div>
            </div>
        </div>
        
        <div id="gameCanvas"></div>
    </div>
    
    <script type="module">
        import EditorScene from './src/phaser/scenes/EditorScene.js';
        
        let game = null;
        let scene = null;
        let testHotspots = [];
        
        // æµ‹è¯•çŠ¶æ€
        const testResults = {
            test1: false,
            test2: false,
            test3: false,
            test4: false,
            test5: false,
            test6: false,
            test7: false,
            test8: false,
            test9: false
        };
        
        window.startTest = function() {
            console.log('ğŸš€ å¼€å§‹æµ‹è¯•...');
            
            // åˆ›å»º Phaser æ¸¸æˆå®ä¾‹
            const config = {
                type: Phaser.AUTO,
                width: 1000,
                height: 600,
                parent: 'gameCanvas',
                backgroundColor: '#2d2d2d',
                scene: EditorScene
            };
            
            game = new Phaser.Game(config);
            
            // ç­‰å¾…åœºæ™¯å‡†å¤‡å¥½
            game.events.once('ready', () => {
                scene = game.scene.getScene('EditorScene');
                console.log('âœ… åœºæ™¯å·²å‡†å¤‡å¥½');
                
                // åˆ›å»ºæµ‹è¯•çƒ­åŒº
                createTestHotspots();
                
                // è®¾ç½®æµ‹è¯•ç›‘å¬
                setupTestListeners();
                
                // å¯ç”¨æŒ‰é’®
                document.getElementById('startTest').disabled = true;
                document.getElementById('resetTest').disabled = false;
            });
        };
        
        window.resetTest = function() {
            console.log('ğŸ”„ é‡ç½®æµ‹è¯•...');
            
            if (game) {
                game.destroy(true);
                game = null;
                scene = null;
                testHotspots = [];
            }
            
            // é‡ç½®æµ‹è¯•çŠ¶æ€
            Object.keys(testResults).forEach(key => {
                testResults[key] = false;
                const testItem = document.getElementById(key);
                testItem.className = 'test-item pending';
                testItem.querySelector('.status').className = 'status pending';
                testItem.querySelector('.status').textContent = 'å¾…æµ‹è¯•';
                document.getElementById(`result${key.slice(4)}`).textContent = '';
            });
            
            // å¯ç”¨æŒ‰é’®
            document.getElementById('startTest').disabled = false;
            document.getElementById('resetTest').disabled = true;
        };
        
        function createTestHotspots() {
            console.log('ğŸ“¦ åˆ›å»ºæµ‹è¯•çƒ­åŒº...');
            
            // åˆ›å»ºçŸ©å½¢çƒ­åŒº
            const rect = {
                id: 'test-rect',
                shape: 'rect',
                x: 200,
                y: 200,
                width: 150,
                height: 100,
                color: '#00ff00',
                startTime: 0,
                endTime: 999999
            };
            scene.addHotspot(rect);
            testHotspots.push(rect);
            
            // åˆ›å»ºåœ†å½¢çƒ­åŒº
            const circle = {
                id: 'test-circle',
                shape: 'circle',
                x: 450,
                y: 200,
                radius: 60,
                color: '#00ff00',
                startTime: 0,
                endTime: 999999
            };
            scene.addHotspot(circle);
            testHotspots.push(circle);
            
            // åˆ›å»ºæ¤­åœ†çƒ­åŒº
            const ellipse = {
                id: 'test-ellipse',
                shape: 'ellipse',
                x: 700,
                y: 200,
                radiusX: 80,
                radiusY: 50,
                color: '#00ff00',
                startTime: 0,
                endTime: 999999
            };
            scene.addHotspot(ellipse);
            testHotspots.push(ellipse);
            
            console.log('âœ… æµ‹è¯•çƒ­åŒºå·²åˆ›å»º:', testHotspots.length);
        }
        
        function setupTestListeners() {
            console.log('ğŸ‘‚ è®¾ç½®æµ‹è¯•ç›‘å¬...');
            
            // æµ‹è¯• 1: å•ä¸ªçƒ­åŒºæ‹–æ‹½
            scene.events.on('hotspot:moved', (data) => {
                if (!testResults.test1) {
                    testResults.test1 = true;
                    updateTestResult('test1', true, `çƒ­åŒºå·²ç§»åŠ¨: ${data.hotspot.config.id}`);
                }
            });
            
            // æµ‹è¯• 2: å¤šä¸ªçƒ­åŒºæ‹–æ‹½
            scene.events.on('hotspots:moved', (data) => {
                if (!testResults.test2 && data.hotspots.length > 1) {
                    testResults.test2 = true;
                    updateTestResult('test2', true, `${data.hotspots.length} ä¸ªçƒ­åŒºåŒæ—¶ç§»åŠ¨`);
                }
            });
            
            // æµ‹è¯• 3: ç¼©æ”¾æ‰‹æŸ„æ˜¾ç¤º
            scene.events.on('selection:changed', (data) => {
                if (!testResults.test3 && data.count === 1) {
                    const hotspot = data.selected[0];
                    if (hotspot.resizeHandles && hotspot.showHandles) {
                        testResults.test3 = true;
                        updateTestResult('test3', true, `ç¼©æ”¾æ‰‹æŸ„å·²æ˜¾ç¤º: ${hotspot.resizeHandles.length} ä¸ª`);
                    }
                }
            });
            
            // æµ‹è¯• 4: 8 ä¸ªæ–¹å‘ç¼©æ”¾
            let resizeCount = 0;
            scene.events.on('hotspot:resized', (data) => {
                if (data.hotspot.config.shape === 'rect') {
                    resizeCount++;
                    if (!testResults.test4 && resizeCount >= 3) {
                        testResults.test4 = true;
                        updateTestResult('test4', true, `çŸ©å½¢å·²ç¼©æ”¾ ${resizeCount} æ¬¡`);
                    }
                }
                
                // æµ‹è¯• 6: æœ€å°å°ºå¯¸é™åˆ¶
                if (!testResults.test6) {
                    const minSize = 20;
                    const minRadius = 10;
                    let hasMinLimit = false;
                    
                    if (data.hotspot.config.shape === 'rect') {
                        hasMinLimit = data.hotspot.config.width >= minSize && 
                                     data.hotspot.config.height >= minSize;
                    } else if (data.hotspot.config.shape === 'circle') {
                        hasMinLimit = data.hotspot.config.radius >= minRadius;
                    } else if (data.hotspot.config.shape === 'ellipse') {
                        hasMinLimit = data.hotspot.config.radiusX >= minRadius && 
                                     data.hotspot.config.radiusY >= minRadius;
                    }
                    
                    if (hasMinLimit) {
                        testResults.test6 = true;
                        updateTestResult('test6', true, 'æœ€å°å°ºå¯¸é™åˆ¶æ­£å¸¸å·¥ä½œ');
                    }
                }
            });
            
            // æµ‹è¯• 5: Shift ä¿æŒæ¯”ä¾‹ï¼ˆéœ€è¦æ‰‹åŠ¨éªŒè¯ï¼‰
            // è¿™ä¸ªæµ‹è¯•éœ€è¦ç”¨æˆ·æŒ‰ä½ Shift é”®ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›‘å¬é”®ç›˜äº‹ä»¶
            scene.input.keyboard.on('keydown-SHIFT', () => {
                if (!testResults.test5) {
                    // æç¤ºç”¨æˆ·ç°åœ¨å¯ä»¥æµ‹è¯• Shift ä¿æŒæ¯”ä¾‹
                    updateTestResult('test5', 'pending', 'è¯·æŒ‰ä½ Shift æ‹–æ‹½è§’æ‰‹æŸ„æµ‹è¯•');
                }
            });
            
            // å½“ç”¨æˆ·æŒ‰ä½ Shift å¹¶ç¼©æ”¾æ—¶ï¼ŒéªŒè¯æ¯”ä¾‹
            let shiftResizeCount = 0;
            scene.events.on('hotspot:resized', (data) => {
                if (scene.input.keyboard.addKey('SHIFT').isDown && 
                    data.hotspot.config.shape === 'rect') {
                    shiftResizeCount++;
                    if (!testResults.test5 && shiftResizeCount >= 1) {
                        testResults.test5 = true;
                        updateTestResult('test5', true, 'Shift ä¿æŒæ¯”ä¾‹åŠŸèƒ½æ­£å¸¸');
                    }
                }
            });
            
            // æµ‹è¯• 7: æ‹–æ‹½å¸é™„å¯¹é½
            let snapDetected = false;
            const originalDrag = scene.events.listeners('hotspot:drag');
            scene.events.on('hotspot:drag', (hotspot) => {
                // æ£€æŸ¥æ˜¯å¦æœ‰å¯¹é½çº¿æ˜¾ç¤º
                if (scene.dragSnapHelper && scene.dragSnapHelper.alignLines && 
                    scene.dragSnapHelper.alignLines.visible) {
                    if (!snapDetected) {
                        snapDetected = true;
                        testResults.test7 = true;
                        updateTestResult('test7', true, 'å¸é™„å¯¹é½åŠŸèƒ½æ­£å¸¸ï¼Œå¯¹é½çº¿å·²æ˜¾ç¤º');
                    }
                }
            });
            
            // æµ‹è¯• 8: Ctrl æ‹–æ‹½å¤åˆ¶
            let hotspotCountBefore = scene.hotspots.length;
            scene.events.on('hotspot:added', (hotspot) => {
                if (scene.advancedDragHelper && scene.advancedDragHelper.isDraggingCopy) {
                    if (!testResults.test8) {
                        testResults.test8 = true;
                        const newCount = scene.hotspots.length;
                        updateTestResult('test8', true, `Ctrl æ‹–æ‹½å¤åˆ¶æˆåŠŸï¼Œçƒ­åŒºæ•°é‡: ${hotspotCountBefore} â†’ ${newCount}`);
                    }
                }
            });
            
            // æµ‹è¯• 9: Alt ä»ä¸­å¿ƒç¼©æ”¾
            scene.events.on('hotspot:resized', (data) => {
                if (scene.advancedDragHelper && scene.advancedDragHelper.isAltResize) {
                    if (!testResults.test9) {
                        testResults.test9 = true;
                        updateTestResult('test9', true, 'Alt ä»ä¸­å¿ƒç¼©æ”¾åŠŸèƒ½æ­£å¸¸');
                    }
                }
            });
        }
        
        function updateTestResult(testId, pass, message) {
            const testItem = document.getElementById(testId);
            const statusEl = testItem.querySelector('.status');
            const resultEl = document.getElementById(`result${testId.slice(4)}`);
            
            if (pass === true) {
                testItem.className = 'test-item pass';
                statusEl.className = 'status pass';
                statusEl.textContent = 'âœ… é€šè¿‡';
            } else if (pass === false) {
                testItem.className = 'test-item fail';
                statusEl.className = 'status fail';
                statusEl.textContent = 'âŒ å¤±è´¥';
            } else {
                testItem.className = 'test-item pending';
                statusEl.className = 'status pending';
                statusEl.textContent = 'â³ æµ‹è¯•ä¸­';
            }
            
            resultEl.textContent = message;
            console.log(`ğŸ“Š ${testId}: ${pass ? 'âœ…' : 'âŒ'} ${message}`);
        }
    </script>
</body>
</html>
