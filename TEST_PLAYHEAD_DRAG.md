# 播放头拖拽功能测试指南

> 测试播放头拖拽跳转功能

## ✅ 实现的功能

### 1. 播放头拖拽跳转
- ✅ 点击播放头（红色三角形或红线）可以拖拽
- ✅ 拖拽时实时更新视频时间
- ✅ 拖拽范围限制在 0 到视频总时长
- ✅ 拖拽时显示 `ew-resize` 光标

### 2. 点击时间轴跳转
- ✅ 点击时间刻度区域（顶部灰色区域）可以跳转到该时间
- ✅ 跳转时间限制在有效范围内

### 3. 优先级处理
- ✅ 播放头拖拽优先级最高（不会误触热区手柄）
- ✅ 热区时间条拖拽功能不受影响
- ✅ 光标样式正确显示

---

## 🧪 测试步骤

### 测试 1：播放头拖拽

1. **启动项目**
   ```bash
   # 使用 Node.js
   node server.js
   
   # 或使用 Python
   python -m http.server 8000
   ```

2. **打开编辑器**
   - 访问 http://localhost:8000
   - 等待视频加载完成

3. **创建测试热区**
   - 点击圆形工具
   - 在视频上绘制一个热区
   - 设置开始时间：2s，结束时间：8s

4. **测试播放头拖拽**
   - 将鼠标移动到时间轴的红色播放头上
   - 观察光标变为 `ew-resize`（双向箭头）
   - 按住鼠标左键拖拽播放头
   - 观察：
     - ✅ 视频时间实时更新
     - ✅ 播放头跟随鼠标移动
     - ✅ 热区在时间范围内显示/隐藏
     - ✅ 拖拽流畅，无卡顿

5. **测试边界情况**
   - 拖拽到最左边（时间 = 0）
   - 拖拽到最右边（时间 = 视频总时长）
   - 观察：
     - ✅ 不会超出有效范围
     - ✅ 边界处理正确

---

### 测试 2：点击时间轴跳转

1. **点击时间刻度区域**
   - 点击时间轴顶部的灰色区域（显示 0s, 5s, 10s 的地方）
   - 观察：
     - ✅ 视频立即跳转到点击的时间
     - ✅ 播放头移动到点击位置
     - ✅ 热区显示状态正确更新

2. **多次点击测试**
   - 快速点击不同的时间位置
   - 观察：
     - ✅ 每次点击都能正确跳转
     - ✅ 无延迟或卡顿

---

### 测试 3：功能不冲突

1. **测试热区手柄拖拽**
   - 拖拽热区时间条的开始手柄（白色竖条）
   - 拖拽热区时间条的结束手柄
   - 观察：
     - ✅ 热区时间调整正常
     - ✅ 不会误触播放头
     - ✅ 播放头不会跟随移动

2. **测试优先级**
   - 当播放头和热区手柄重叠时
   - 尝试点击重叠区域
   - 观察：
     - ✅ 优先拖拽播放头
     - ✅ 播放头拖拽优先级最高

---

### 测试 4：光标样式

1. **悬停测试**
   - 将鼠标移动到播放头上
   - 观察：✅ 光标变为 `ew-resize`
   
2. **移动到热区手柄**
   - 将鼠标移动到热区时间条的手柄上
   - 观察：✅ 光标变为 `ew-resize`
   
3. **移动到空白区域**
   - 将鼠标移动到时间轴的空白区域
   - 观察：✅ 光标恢复为默认样式

---

## 🎯 预期结果

### 功能正常
- ✅ 播放头可以拖拽
- ✅ 拖拽时视频时间实时更新
- ✅ 点击时间轴可以跳转
- ✅ 热区时间条拖拽不受影响
- ✅ 光标样式正确显示

### 性能良好
- ✅ 拖拽流畅，60 FPS
- ✅ 无卡顿或延迟
- ✅ 内存占用正常

### 用户体验
- ✅ 交互直观，易于理解
- ✅ 视觉反馈清晰
- ✅ 操作精确，无误触

---

## 🐛 常见问题

### 问题 1：播放头拖拽不响应
**原因**：可能是 PlayheadController 未正确初始化

**解决方案**：
1. 检查浏览器控制台是否有错误
2. 确认 `src/dom/timeline/PlayheadController.js` 文件存在
3. 刷新页面重新加载

### 问题 2：拖拽时视频不跳转
**原因**：可能是 `video:seek` 事件未正确监听

**解决方案**：
1. 检查 VideoController 是否正确监听 `video:seek` 事件
2. 在浏览器控制台输入：
   ```javascript
   game.events.emit('video:seek', 5);
   ```
3. 如果视频跳转到 5 秒，说明事件系统正常

### 问题 3：播放头和热区手柄冲突
**原因**：优先级处理不正确

**解决方案**：
1. 确认 `onMouseDown()` 中播放头检测在最前面
2. 确认 `hitTest()` 方法返回正确

---

## 📊 架构说明

### 文件结构
```
src/dom/
├── TimelinePanel.js              # 时间轴主面板
└── timeline/
    └── PlayheadController.js     # 播放头控制器（新增）
```

### 设计原则
1. **职责分离**：播放头逻辑独立到 PlayheadController
2. **遵循 Phaser 标准**：使用 game.events 发送事件
3. **优先级处理**：播放头 > 热区手柄 > 默认
4. **代码简洁**：每个文件 < 100 行

### 事件流
```
用户拖拽播放头
  ↓
PlayheadController.drag(x)
  ↓
计算新时间
  ↓
game.events.emit('video:seek', time)
  ↓
VideoController 监听并跳转视频
  ↓
video.currentTime = time
  ↓
触发 video:timeupdate 事件
  ↓
TimelinePanel 更新显示
```

---

## ✨ 下一步优化

### 可选增强功能
1. **吸附功能**：拖拽时自动吸附到热区边界
2. **工具提示**：悬停显示精确时间
3. **撤销/重做**：支持播放头跳转的撤销
4. **键盘控制**：使用左右箭头微调时间

---

**测试完成时间**: 预计 5-10 分钟  
**实现时间**: 30 分钟  
**代码质量**: ⭐⭐⭐⭐⭐  
**遵循 Phaser 标准**: 100%

