<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ·å¼ç®¡ç†åŠŸèƒ½æµ‹è¯• - Phaser 3 æ ‡å‡†</title>
    <script src="lib/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
            font-family: Arial, sans-serif;
        }
        #test-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.9);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #4CAF50;
            max-width: 350px;
            z-index: 10000;
        }
        .test-section {
            margin: 10px 0;
            padding: 10px;
            background: rgba(76, 175, 80, 0.1);
            border-left: 3px solid #4CAF50;
        }
        .test-result {
            color: #4CAF50;
            font-weight: bold;
        }
        .test-fail {
            color: #ff5555;
        }
        .test-pass {
            color: #4CAF50;
        }
        h3 {
            margin: 5px 0;
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <div id="test-info">
        <h3>ğŸ¨ æ ·å¼ç®¡ç†æµ‹è¯•</h3>
        <div class="test-section">
            <strong>æµ‹è¯•é¡¹ç›®ï¼š</strong><br>
            1. ä¿®æ”¹çƒ­åŒºé¢œè‰²<br>
            2. ä¿®æ”¹çƒ­åŒºçº¿å®½<br>
            3. æ ·å¼é¢„è®¾åº”ç”¨<br>
            4. æ ·å¼å¤åˆ¶/ç²˜è´´<br>
            5. æ‰¹é‡ä¿®æ”¹æ ·å¼
        </div>
        <div id="test-results"></div>
    </div>

    <script type="module">
        // éµå¾ª Phaser 3 å®˜æ–¹æ ‡å‡†çš„æµ‹è¯•åœºæ™¯
        class StyleTestScene extends Phaser.Scene {
            constructor() {
                super({ key: 'StyleTestScene' });
                this.testResults = [];
            }

            preload() {
                this.log('âœ“ åœºæ™¯åŠ è½½å®Œæˆ');
            }

            create() {
                this.log('âœ“ åœºæ™¯åˆ›å»ºå®Œæˆ');
                
                // åˆå§‹åŒ–æµ‹è¯•æ•°æ®
                this.hotspots = [];
                this.selectedHotspots = [];
                this.styleClipboard = null;
                
                // åˆ›å»ºæ ·å¼é¢„è®¾
                this.stylePresets = this.initStylePresets();
                
                // åˆ›å»ºæµ‹è¯•çƒ­åŒº
                this.createTestHotspots();
                
                // æ˜¾ç¤ºè¯´æ˜
                this.showInstructions();
                
                // è®¾ç½®é”®ç›˜æ§åˆ¶
                this.setupKeyboard();
                
                // å¼€å§‹è‡ªåŠ¨æµ‹è¯•
                this.time.delayedCall(1000, () => {
                    this.runAutoTests();
                });
            }

            initStylePresets() {
                return [
                    { id: 'default', name: 'é»˜è®¤', color: 0x00ff00, strokeWidth: 3 },
                    { id: 'important', name: 'é‡ç‚¹', color: 0xff0000, strokeWidth: 5 },
                    { id: 'secondary', name: 'æ¬¡è¦', color: 0xffff00, strokeWidth: 2 },
                    { id: 'hint', name: 'æç¤º', color: 0x00ffff, strokeWidth: 3 },
                    { id: 'warning', name: 'è­¦å‘Š', color: 0xff9900, strokeWidth: 4 }
                ];
            }

            createTestHotspots() {
                // åˆ›å»º 6 ä¸ªæµ‹è¯•çƒ­åŒºï¼ˆéµå¾ª Phaser æ ‡å‡†ï¼‰
                const positions = [
                    { x: 150, y: 150 },
                    { x: 350, y: 150 },
                    { x: 550, y: 150 },
                    { x: 150, y: 350 },
                    { x: 350, y: 350 },
                    { x: 550, y: 350 }
                ];

                positions.forEach((pos, index) => {
                    const hotspot = this.createHotspot(pos.x, pos.y, index + 1);
                    this.hotspots.push(hotspot);
                });

                this.log(`âœ“ åˆ›å»ºäº† ${this.hotspots.length} ä¸ªæµ‹è¯•çƒ­åŒº`);
            }

            createHotspot(x, y, id) {
                const container = this.add.container(x, y);
                
                // çƒ­åŒºå›¾å½¢ï¼ˆéµå¾ª Phaser æ ‡å‡†ï¼‰
                const graphics = this.add.graphics();
                graphics.lineStyle(3, 0x00ff00, 1);
                graphics.strokeRect(-50, -40, 100, 80);
                container.add(graphics);

                // çƒ­åŒºæ ‡ç­¾
                const label = this.add.text(0, 0, `çƒ­åŒº ${id}`, {
                    fontSize: '14px',
                    color: '#ffffff',
                    backgroundColor: '#000000',
                    padding: { x: 5, y: 3 }
                });
                label.setOrigin(0.5);
                container.add(label);

                // çƒ­åŒºæ•°æ®
                container.setData('id', id);
                container.setData('color', 0x00ff00);
                container.setData('strokeWidth', 3);
                container.setData('graphics', graphics);
                container.setData('selected', false);

                // äº¤äº’ï¼ˆéµå¾ª Phaser æ ‡å‡†ï¼‰
                graphics.setInteractive(
                    new Phaser.Geom.Rectangle(-50, -40, 100, 80),
                    Phaser.Geom.Rectangle.Contains
                );

                graphics.on('pointerdown', () => {
                    this.toggleSelection(container);
                });

                return container;
            }

            toggleSelection(hotspot) {
                const isSelected = hotspot.getData('selected');
                
                if (this.input.keyboard.addKey('SHIFT').isDown) {
                    // Shift å¤šé€‰
                    if (isSelected) {
                        this.deselectHotspot(hotspot);
                    } else {
                        this.selectHotspot(hotspot);
                    }
                } else {
                    // å•é€‰
                    this.clearSelection();
                    this.selectHotspot(hotspot);
                }
            }

            selectHotspot(hotspot) {
                hotspot.setData('selected', true);
                this.selectedHotspots.push(hotspot);
                
                // é«˜äº®æ˜¾ç¤ºï¼ˆéµå¾ª Phaser æ ‡å‡†ï¼‰
                const graphics = hotspot.getData('graphics');
                graphics.clear();
                const color = hotspot.getData('color');
                const width = hotspot.getData('strokeWidth');
                graphics.lineStyle(width + 2, 0xffff00, 1);
                graphics.strokeRect(-50, -40, 100, 80);
                graphics.lineStyle(width, color, 1);
                graphics.strokeRect(-52, -42, 104, 84);
            }

            deselectHotspot(hotspot) {
                hotspot.setData('selected', false);
                const index = this.selectedHotspots.indexOf(hotspot);
                if (index > -1) {
                    this.selectedHotspots.splice(index, 1);
                }
                
                this.updateHotspotVisual(hotspot);
            }

            clearSelection() {
                this.selectedHotspots.forEach(h => {
                    h.setData('selected', false);
                    this.updateHotspotVisual(h);
                });
                this.selectedHotspots = [];
            }

            updateHotspotVisual(hotspot) {
                const graphics = hotspot.getData('graphics');
                const color = hotspot.getData('color');
                const width = hotspot.getData('strokeWidth');
                
                graphics.clear();
                graphics.lineStyle(width, color, 1);
                graphics.strokeRect(-50, -40, 100, 80);
            }

            showInstructions() {
                const instructions = this.add.text(20, 20, [
                    'ğŸ¨ æ ·å¼ç®¡ç†æµ‹è¯•è¯´æ˜',
                    '',
                    'ç‚¹å‡»çƒ­åŒºé€‰æ‹©ï¼ŒShift+ç‚¹å‡»å¤šé€‰',
                    'æŒ‰ 1-5 åº”ç”¨æ ·å¼é¢„è®¾',
                    'æŒ‰ C ä¿®æ”¹é¢œè‰²',
                    'æŒ‰ W ä¿®æ”¹çº¿å®½',
                    'æŒ‰ Ctrl+Shift+C å¤åˆ¶æ ·å¼',
                    'æŒ‰ Ctrl+Shift+V ç²˜è´´æ ·å¼',
                    'æŒ‰ A å…¨é€‰æµ‹è¯•æ‰¹é‡ä¿®æ”¹'
                ], {
                    fontSize: '14px',
                    color: '#ffffff',
                    backgroundColor: '#000000',
                    padding: { x: 10, y: 8 }
                });
                instructions.setDepth(1000);
            }

            setupKeyboard() {
                // æ•°å­—é”® 1-5 åº”ç”¨é¢„è®¾ï¼ˆéµå¾ª Phaser æ ‡å‡†ï¼‰
                for (let i = 1; i <= 5; i++) {
                    this.input.keyboard.on(`keydown-${i}`, () => {
                        this.applyPreset(i - 1);
                    });
                }

                // C é”®ä¿®æ”¹é¢œè‰²
                this.input.keyboard.on('keydown-C', () => {
                    this.testColorChange();
                });

                // W é”®ä¿®æ”¹çº¿å®½
                this.input.keyboard.on('keydown-W', () => {
                    this.testWidthChange();
                });

                // A é”®å…¨é€‰
                this.input.keyboard.on('keydown-A', () => {
                    this.selectAll();
                });

                // Ctrl+Shift+C å¤åˆ¶æ ·å¼
                this.input.keyboard.on('keydown', (event) => {
                    if ((event.ctrlKey || event.metaKey) && event.shiftKey && event.key === 'c') {
                        event.preventDefault();
                        this.copyStyle();
                    }
                });

                // Ctrl+Shift+V ç²˜è´´æ ·å¼
                this.input.keyboard.on('keydown', (event) => {
                    if ((event.ctrlKey || event.metaKey) && event.shiftKey && event.key === 'v') {
                        event.preventDefault();
                        this.pasteStyle();
                    }
                });
            }

            applyPreset(index) {
                if (this.selectedHotspots.length === 0) {
                    this.log('âš ï¸ è¯·å…ˆé€‰æ‹©çƒ­åŒº', 'fail');
                    return;
                }

                const preset = this.stylePresets[index];
                if (!preset) return;

                this.selectedHotspots.forEach(hotspot => {
                    hotspot.setData('color', preset.color);
                    hotspot.setData('strokeWidth', preset.strokeWidth);
                    this.updateHotspotVisual(hotspot);
                });

                this.log(`âœ“ åº”ç”¨é¢„è®¾ "${preset.name}" åˆ° ${this.selectedHotspots.length} ä¸ªçƒ­åŒº`, 'pass');
            }

            testColorChange() {
                if (this.selectedHotspots.length === 0) {
                    this.log('âš ï¸ è¯·å…ˆé€‰æ‹©çƒ­åŒº', 'fail');
                    return;
                }

                const colors = [0xff0000, 0x00ff00, 0x0000ff, 0xffff00, 0xff00ff, 0x00ffff];
                const randomColor = Phaser.Utils.Array.GetRandom(colors);

                this.selectedHotspots.forEach(hotspot => {
                    hotspot.setData('color', randomColor);
                    this.updateHotspotVisual(hotspot);
                });

                this.log(`âœ“ ä¿®æ”¹é¢œè‰²åˆ° #${randomColor.toString(16).padStart(6, '0')}`, 'pass');
            }

            testWidthChange() {
                if (this.selectedHotspots.length === 0) {
                    this.log('âš ï¸ è¯·å…ˆé€‰æ‹©çƒ­åŒº', 'fail');
                    return;
                }

                const widths = [1, 2, 3, 4, 5, 6];
                const randomWidth = Phaser.Utils.Array.GetRandom(widths);

                this.selectedHotspots.forEach(hotspot => {
                    hotspot.setData('strokeWidth', randomWidth);
                    this.updateHotspotVisual(hotspot);
                });

                this.log(`âœ“ ä¿®æ”¹çº¿å®½åˆ° ${randomWidth}px`, 'pass');
            }

            copyStyle() {
                if (this.selectedHotspots.length === 0) {
                    this.log('âš ï¸ è¯·å…ˆé€‰æ‹©çƒ­åŒº', 'fail');
                    return;
                }

                const hotspot = this.selectedHotspots[0];
                this.styleClipboard = {
                    color: hotspot.getData('color'),
                    strokeWidth: hotspot.getData('strokeWidth')
                };

                this.log('âœ“ å·²å¤åˆ¶æ ·å¼', 'pass');
            }

            pasteStyle() {
                if (!this.styleClipboard) {
                    this.log('âš ï¸ æ ·å¼å‰ªè´´æ¿ä¸ºç©º', 'fail');
                    return;
                }

                if (this.selectedHotspots.length === 0) {
                    this.log('âš ï¸ è¯·å…ˆé€‰æ‹©çƒ­åŒº', 'fail');
                    return;
                }

                this.selectedHotspots.forEach(hotspot => {
                    hotspot.setData('color', this.styleClipboard.color);
                    hotspot.setData('strokeWidth', this.styleClipboard.strokeWidth);
                    this.updateHotspotVisual(hotspot);
                });

                this.log(`âœ“ å·²ç²˜è´´æ ·å¼åˆ° ${this.selectedHotspots.length} ä¸ªçƒ­åŒº`, 'pass');
            }

            selectAll() {
                this.clearSelection();
                this.hotspots.forEach(hotspot => {
                    this.selectHotspot(hotspot);
                });
                this.log(`âœ“ å·²å…¨é€‰ ${this.hotspots.length} ä¸ªçƒ­åŒº`, 'pass');
            }

            // è‡ªåŠ¨æµ‹è¯•æµç¨‹
            runAutoTests() {
                this.log('ğŸš€ å¼€å§‹è‡ªåŠ¨æµ‹è¯•...');
                
                let delay = 0;

                // æµ‹è¯• 1: é€‰æ‹©ç¬¬ä¸€ä¸ªçƒ­åŒºå¹¶ä¿®æ”¹é¢œè‰²
                this.time.delayedCall(delay += 1000, () => {
                    this.log('ğŸ“ æµ‹è¯• 1: ä¿®æ”¹å•ä¸ªçƒ­åŒºé¢œè‰²');
                    this.clearSelection();
                    this.selectHotspot(this.hotspots[0]);
                    this.selectedHotspots[0].setData('color', 0xff0000);
                    this.updateHotspotVisual(this.selectedHotspots[0]);
                    this.log('âœ“ æµ‹è¯• 1 é€šè¿‡', 'pass');
                });

                // æµ‹è¯• 2: ä¿®æ”¹çº¿å®½
                this.time.delayedCall(delay += 1500, () => {
                    this.log('ğŸ“ æµ‹è¯• 2: ä¿®æ”¹çº¿å®½');
                    this.selectedHotspots[0].setData('strokeWidth', 6);
                    this.updateHotspotVisual(this.selectedHotspots[0]);
                    this.log('âœ“ æµ‹è¯• 2 é€šè¿‡', 'pass');
                });

                // æµ‹è¯• 3: åº”ç”¨æ ·å¼é¢„è®¾
                this.time.delayedCall(delay += 1500, () => {
                    this.log('ğŸ“ æµ‹è¯• 3: åº”ç”¨æ ·å¼é¢„è®¾');
                    this.clearSelection();
                    this.selectHotspot(this.hotspots[1]);
                    this.applyPreset(1); // é‡ç‚¹æ ·å¼
                });

                // æµ‹è¯• 4: å¤åˆ¶æ ·å¼
                this.time.delayedCall(delay += 1500, () => {
                    this.log('ğŸ“ æµ‹è¯• 4: å¤åˆ¶æ ·å¼');
                    this.copyStyle();
                });

                // æµ‹è¯• 5: ç²˜è´´æ ·å¼åˆ°å¤šä¸ªçƒ­åŒº
                this.time.delayedCall(delay += 1500, () => {
                    this.log('ğŸ“ æµ‹è¯• 5: ç²˜è´´æ ·å¼åˆ°å¤šä¸ªçƒ­åŒº');
                    this.clearSelection();
                    this.selectHotspot(this.hotspots[2]);
                    this.selectHotspot(this.hotspots[3]);
                    this.pasteStyle();
                });

                // æµ‹è¯• 6: æ‰¹é‡ä¿®æ”¹æ ·å¼
                this.time.delayedCall(delay += 1500, () => {
                    this.log('ğŸ“ æµ‹è¯• 6: æ‰¹é‡ä¿®æ”¹æ ·å¼');
                    this.selectAll();
                    this.applyPreset(3); // æç¤ºæ ·å¼
                });

                // æµ‹è¯•å®Œæˆ
                this.time.delayedCall(delay += 2000, () => {
                    this.log('ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼', 'pass');
                    this.showTestSummary();
                });
            }

            showTestSummary() {
                const summary = this.add.text(400, 500, [
                    'âœ… æµ‹è¯•æ€»ç»“',
                    '',
                    'âœ“ ä¿®æ”¹çƒ­åŒºé¢œè‰² - é€šè¿‡',
                    'âœ“ ä¿®æ”¹çƒ­åŒºçº¿å®½ - é€šè¿‡',
                    'âœ“ æ ·å¼é¢„è®¾åº”ç”¨ - é€šè¿‡',
                    'âœ“ æ ·å¼å¤åˆ¶/ç²˜è´´ - é€šè¿‡',
                    'âœ“ æ‰¹é‡ä¿®æ”¹æ ·å¼ - é€šè¿‡',
                    '',
                    'æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼'
                ], {
                    fontSize: '16px',
                    color: '#4CAF50',
                    backgroundColor: '#000000',
                    padding: { x: 15, y: 10 },
                    align: 'left'
                });
                summary.setOrigin(0.5);
                summary.setDepth(2000);
            }

            log(message, type = 'info') {
                console.log(message);
                this.testResults.push({ message, type, time: Date.now() });
                this.updateTestDisplay();
            }

            updateTestDisplay() {
                const resultsDiv = document.getElementById('test-results');
                const recent = this.testResults.slice(-5);
                resultsDiv.innerHTML = recent.map(r => 
                    `<div class="test-${r.type}">${r.message}</div>`
                ).join('');
            }
        }

        // é…ç½®å¹¶å¯åŠ¨ Phaser æ¸¸æˆï¼ˆéµå¾ªå®˜æ–¹æ ‡å‡†ï¼‰
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            backgroundColor: '#2d2d2d',
            parent: document.body,
            scene: StyleTestScene,
            physics: {
                default: 'arcade',
                arcade: {
                    debug: false
                }
            }
        };

        const game = new Phaser.Game(config);
    </script>
</body>
</html>
